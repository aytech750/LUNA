<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luna - Sign Up</title>
  <link rel="stylesheet" href="signup.css" />
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
</head>

<body class="signup-body">
  <div class="form-container">
    <img src="https://i.imgur.com/8KlT8jJ.png" alt="Luna Logo" class="logo" />
    <h1>Create Your Luna Account</h1>

    <form id="signupForm">
      <input type="text" id="name" placeholder="Full Name" required />
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />

      <div class="record-wakeword">
        <p class="record-title">Record Your Wake Word</p>
        <button type="button" class="record-btn" onclick="handleWakeWordRecording()">
          <img src="https://cdn-icons-png.flaticon.com/512/727/727245.png" alt="Mic" class="mic-icon">
          <span>Start Recording</span>
        </button>
        <p class="record-status" id="record-status">Not recording</p>
      </div>

      <button type="submit">Sign Up</button>
    </form>

    <div id="spinnerOverlay" class="spinner-overlay" style="display:none;">
      <img src="https://i.imgur.com/8KlT8jJ.png" alt="Luna Spinner" class="spinner-logo" />
    </div>

    <p class="login-link">Already have an account? <a href="login.html">Login</a></p>
  </div>

     <div id="spinnerOverlay" class="spinner-overlay">
      <img src="https://i.imgur.com/8KlT8jJ.png" alt="Luna Spinner" class="spinner-logo" />
    </div>
  <section class="about-luna">
  <h2>Why Choose <span class="luna">Luna</span>?</h2>
  <div class="features">
    <div>
      <h3>üåü Our Mission</h3>
      <p>To revolutionize the way people connect with technology using voice-driven AI experiences that are simple, secure, and smart.</p>
    </div>
    <div>
      <h3>üöÄ Our Innovation</h3>
      <p>Luna combines the power of AI, voice recognition, and personalized assistance, offering a smarter way to interact with your world.</p>
    </div>
    <div>
      <h3>ü§ù Why Luna?</h3>
      <p>Unlike other platforms, Luna is designed to be intuitive, friendly, and accessible, serving as your social and smart assistant.</p>
    </div>
    <div>
     <h3>üíº About LunaAI</h3>
<p style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; font-size: 16px; line-height: 1.6;">
  <img src="https://img.icons8.com/color/48/artificial-intelligence.png" alt="AI Icon" style="width: 24px; height: 24px;" />
  <span style="flex: 1;">
    <strong>LunaAI</strong> is an innovative voice assistant developed by <strong>AyTech</strong>‚Äîa rising tech firm known for simplifying complex problems through smart solutions. <br />
    Other products by AyTech include <em>Freenium Data</em>, <em>Osun Ride</em>, and more.
  </span>
  <img src="https://img.icons8.com/fluency/48/source-code.png" alt="Tech Code Icon" style="width: 24px; height: 24px;" />
  <img src="https://img.icons8.com/color/48/voice-recognition.png" alt="Voice Recognition Icon" style="width: 24px; height: 24px;" />
</p>


    </div>
  </div>

  <div class="connect">
    <p>Connect with us:</p>
    <a href="https://wa.me/your_number" target="_blank">
      <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="WhatsApp" />
    </a>
    <a href="https://instagram.com/your_handle" target="_blank">
      <img src="https://img.icons8.com/fluency/48/instagram-new.png" alt="Instagram" />
    </a>
    <a href="https://tiktok.com/@your_handle" target="_blank">
      <img src="https://img.icons8.com/color/48/tiktok--v1.png" alt="TikTok" />
    </a>
  </div>

  <div class="credits">
    <p>&copy; 2025 Luna AI - Created by AyTech</p>
  </div>
</section>
  <script>
  // Firebase config (unchanged)
  const firebaseConfig = {
    apiKey: "AIzaSyDN4hgEwEZkL0gzEmlRWlabjAEt6fY3c88",
    authDomain: "luna-app-a3c50.firebaseapp.com",
    projectId: "luna-app-a3c50",
    storageBucket: "luna-app-a3c50.appspot.com",
    messagingSenderId: "683159311462",
    appId: "1:683159311462:web:2bef289d271172267d49a7"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  let mediaRecorder;
  let wakeWordBlob;
  let recordedWakeWord = "";
  let audioChunks = [];
  let recognition;
  let stream;

  async function handleWakeWordRecording() {
    const status = document.getElementById("record-status");
    const email = document.getElementById("email").value.trim();

    if (!email) {
      Toastify({ text: "Please enter your email first", duration: 3000, backgroundColor: "#ffa000" }).showToast();
      return;
    }

    if (mediaRecorder && mediaRecorder.state === "recording") {
      stopRecording();
      return;
    }

    try {
      stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);
      mediaRecorder.onstop = async () => {
        wakeWordBlob = new Blob(audioChunks, { type: 'audio/webm' });

        // Upload audio to Firebase
        const audioRef = storage.ref().child(`wakewords/${email}_wakeword.webm`);
        try {
          await audioRef.put(wakeWordBlob);
        } catch (e) {
          Toastify({ text: "Audio upload failed", duration: 3000, backgroundColor: "#e53935" }).showToast();
        }
      };

      recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;

      recognition.onstart = () => {
        status.textContent = "Recording... Please say your wake word";
      };

      recognition.onresult = async (event) => {
        recordedWakeWord = event.results[0][0].transcript.trim().toLowerCase();
        status.textContent = `Recognized: "${recordedWakeWord}"`;

        // Save transcript to Firestore
        try {
          await db.collection("wakewords").doc(email).set({ wakeword: recordedWakeWord });
          Toastify({ text: "Wake word saved", duration: 3000, backgroundColor: "#4caf50" }).showToast();
        } catch (err) {
          Toastify({ text: "Error saving wakeword: " + err.message, duration: 3000, backgroundColor: "#e53935" }).showToast();
        }
      };

      recognition.onerror = (e) => {
        status.textContent = "Speech recognition failed";
        console.error("Recognition error", e);
      };

      recognition.onend = () => {
        status.textContent += " (Recording ended)";
      };

      recognition.start();
      mediaRecorder.start();

      // Automatically stop after 5 seconds
      setTimeout(() => {
        stopRecording();
      }, 5000);

    } catch (error) {
      Toastify({ text: "Mic permission error: " + error.message, duration: 3000, backgroundColor: "#d32f2f" }).showToast();
    }
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === "recording") {
      mediaRecorder.stop();
    }
    if (recognition) {
      recognition.stop();
    }
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }

    document.getElementById("record-status").textContent = "Recording stopped";
  }

  const form = document.getElementById("signupForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const spinner = document.getElementById("spinnerOverlay");
    const btn = form.querySelector("button[type='submit']");

    if (!recordedWakeWord || !wakeWordBlob) {
      Toastify({ text: "Please record your wake word before signing up.", duration: 3000, backgroundColor: "#ffa000" }).showToast();
      return;
    }

    btn.disabled = true;
    btn.textContent = "Signing up...";
    spinner.style.display = "flex";

    try {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCredential.user.uid;

      await db.collection("users").doc(uid).set({
        name,
        email,
        createdAt: new Date()
      });

      const audioRef = storage.ref().child(`wakewords/${uid}.webm`);
      await audioRef.put(wakeWordBlob);

      localStorage.setItem("lunaUser", name);
      greetUser(name);

      Toastify({ text: `Welcome, ${name}!`, duration: 3000, backgroundColor: "#2563eb" }).showToast();

      setTimeout(() => {
        spinner.style.display = "none";
        window.location.href = "dashboard.html";
      }, 3000);
    } catch (error) {
      Toastify({ text: error.message, duration: 3000, backgroundColor: "#d32f2f" }).showToast();
      btn.disabled = false;
      btn.textContent = "Sign Up";
      spinner.style.display = "none";
    }
  });

   function greetUser(name) {
  const greeting = `Welcome, ${name}. Luna is happy to meet you!`;
  const utterance = new SpeechSynthesisUtterance(greeting);

  function setVoiceAndSpeak() {
    const voices = speechSynthesis.getVoices();
    const femaleVoice = voices.find(v => v.name.includes("Google") || v.name.toLowerCase().includes("female"));
    if (femaleVoice) utterance.voice = femaleVoice;
    speechSynthesis.speak(utterance);
  }

  // Wait until voices are loaded
  if (speechSynthesis.getVoices().length === 0) {
    speechSynthesis.onvoiceschanged = setVoiceAndSpeak;
  } else {
    setVoiceAndSpeak();
  }
}
</script>

</body>
</html>
